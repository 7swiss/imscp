i-MSCP ChangeLog

------------------------------------------------------------------------------------------------------------------------
Git 1.6.x
------------------------------------------------------------------------------------------------------------------------

BACKEND
    Added: composer.phar compatibility symlink for backward compatibility with plugins
    Added: getBlocByRef(), processByRef() and replaceBlocByRef() subroutines (iMSCP::TemplateParser)
    Added: Support for .timer unit files (Systemd init provider)
    Enhancement: Make it possible to delay execution of the 'start', 'restart' and 'reload' actions (iMSCP::Service)
    Enhancement: Make it possible to discard files/directories when clearing a directory (iMSCP::Dir::clear)
    Enhancement: Make it possible to install Composer anywhere (iMSCP::Composer)
    Enhancement: Make it possible to override default composer.json (iMSCP::Composer)
    Enhancement: Make the iMSCP::Composer package usable by 3rd-party components, without relying on event manager
    Fixed: Avoid localization of `$@' variable
    Fixed: Can't call method "XXXXXX" on unblessed reference -- Object as event listener (iMSCP::EventManager -- regression fix)
    Fixed: Couldn't restore SQL databases -- Can't locate object method "selectall_array" via package "DBI::db"
    Fixed: Couldn't restore uncompressed databases
    Fixed: Existence of network devices must be checked before operating on them (iMSCP::Net)
    Fixed: Make distinction between install and update commands (iMSCP::Composer)
    Fixed: Make sure to work with a well-known composer version (iMSCP::Composer)
    Fixed: Make use of the INADDR_ANY address, regadless of domain IP address when primary server IP is set with `None` option
    Fixed: Symlinks are dereferenced (followed) instead of being copied (iMSCP::Dir::rcopy)
    Fixed: Symlinks are dereferenced (followed) instead of being copied (iMSCP::File::copyFile)
    Fixed: Unexpected permissions set on folders in recursive mode, and when dirmode parameter is not involved (iMSCP::Rights)
    Review: Avoid tables locking whenever possible while dump of databases (iMSCP::Database::mysql::dumpdb)
    Review: Install composer.phar globally under /usr/local/bin (as composer) for reusability (iMSCP::Composer)
    Review: Prefer stable versions of composer packages (iMSCP::Composer)
    Security: Disallow connection to MySQL command-line tool without user password, even for root user
    Security: Don't store i-MSCP master SQL user data into the /etc/mysql/conf.d/imscp.cnf configuration file

CONFIG
    Added: Daily CRON(8) configuration file for i-MSCP frontend (cleanup of tmp directory)
    Added: Dedicated parameters for APCu (PHP APC userland cache -- /etc/imscp/php/php.data)
    Added: Dedicated PHP parameters for the i-MSCP frontend (/etc/imscp/frontend/frontend.data)
    Added: i-MSCP own SOURCES.LIST(5) file
    Added: LOGROTATE(8) configuration file for i-MSCP frontend (PHP errors.log file rotation)
    Added: LOGROTATE(8) configuration file for VsFTPD (Traffic log file rotation)
    Added: LOGROTATE(8) configuration file for rsyslog (Ubuntu 14.04/Trusty Thar)
    Added: LOGROTATE(8) configuration file for syslog-ng (All distributions)
    Added: Missing pbuilder configuration file -- Devuan 1.0/Jessie
    Added: Support for PHP 7.2 (only for distributions that support it)
    Enhancement: Make it possible to override default config by including *.conf files from the /etc/dovecot/imscp.d directory (Dovecot)
    Enhancement: Make it possible to override most of default Apache2 Fcgid module configuration parameters (/etc/imscp/php/php.data)
    Fixed: Make use of the `ssl' parameter of the `listen' directive in place of the `ssl' directive (Nginx)
    Updated: LOGROTATE(8) configuration file for ProFTPD -- Added stanza for traffic log file rotation
    Removed: Support for SQL server versions that are too old (MySQL < 5.7, MariaDB < 10.1, Percona < 5.7)
    Removed: Useless `DATABASE_TYPE` parameter (imscp.conf)
    Removed: Useless imscp LOGROTATE(8) configuration file

CONTRIB
    Added: get_imscp_master_sql_user_pwd.pl script: Print current i-MSCP master SQL user (imscp_user) password

DATABASE
    Fixed: Can't DROP 'domain_id'; check that column/key exists (Database update r267; fixed/repeated in r271)
    Fixed: Deprecated columns not removed while updating from some older versions (r270)

DISTRIBUTIONS
    Added: `libfile-chmod-perl` distribution package (all distributions -- Required by 3rd-party softwares)
    Added: `unzip` distribution package (all distributions -- required for correct symlinks handling (Composer))
    Added: Support for Debian 10/Buster (Experimental)
    Review: Avoid APT pinning whenever as possible (All distributions)
    Relaxed: Permissions policy on /etc/apt/apt.conf.d/* files -- Files must be world-readable

FRONTEND
    Added: Distribution and i-MSCP information in the system information page (admin UI)
    Added: New `mailType' and `forwardList' parameters for both `onBeforeAddMail' and `onAfterAddMail' events
    Added: Support for PSR-4 autoloading through PHP dependency manager (composer) autoloader
    Changed iMSCP\Application::getAutoloader() now return the Composer Composer\Autoload\ClassLoader instance
    Enhancement: Make use of application cache for caching of plugins metadata (lifetime: indefinitely till change)
    Enhancement: Make use of application cache for caching of resolved templates (TemplateEngine)
    Enhancement: PHP error messages are now stored in the data/logs/errors.log file which is rotated on a daily basis
    Fixed: Both `onBeforeAddMail' and `onAfterAddMail' events should be triggered on default mail accounts creation
    Fixed: Couldn't execute /usr/local/lib/imscp_panel/imscp_panel_reopenlogs logrotate script
    Fixed: Couldn't parse static (inline|file) templates due to wrong conditional statement (TemplateEngine)
    Fixed: Couldn't update customer password (admin and reseller UI)
    Fixed: Disabled DNS resource records get re-enabled when editing a record (Custom DNS records -- Client UI)
    Fixed: Exit with proper code on error (FrontEnd)
    Fixed: Fatal error: Call to a member function fetchRow() on string in client/mail_catchall_add.php on line 84
    Fixed: iMSCP_Authentication_AuthEvent badly initialized
    Fixed: isSecureRequest() bad implementation -- `HTTP_X_FORWARDED_PROTO` must take precedence if set
    Fixed: List of customers is truncated due to wrong template variable name in loop (Customer assignments feature)
    Fixed: Misleading domain status due to missing `torestore' status in the translate_dmn_status() function
    Fixed: Notice: Undefined index: page_message (admin, reseller UI -- Domain details interface)
    Fixed: Notice: Undefined index: page_message (admin, UI -- IP usage interface)
    Fixed: Undefined offsets (Support feature - Tickets view interfaces)
    Fixed: Template block tag mismatch (administrator_list vs admin_list) in admin/users.phtml
    Fixed: Template block tag mismatch (domain_list vs domains_list) in client/domain_manage.tpl
    Fixed: Template block tag mismatch (no_webdepotsoftware_list vs no_webdepotsoftware_lists) in admin/software_manage.tpl
    Fixed: Wrong alternative subject names in self-signed SSL certificates
    Fixed: Wrong order for parameters in mail delete.php (i18n -- client UI)
    Fixed: Wrong status shown in administrator overview interface for customers when a password is being modified
    Fixed: Wrong value passed-in the `onBeforeEditUser' and `onAfterEditUser' events for the `admin_pass' parameter
    Review: Make use of composer autoloader for loading of vendor dependencies
    Review: Prepare the SQL statements once per session (objects counting, stats)
    Removed: iMSCP_Events_Aggregator class (now an alias of iMSCP_Events_Manager)
    Rewritten: iMSCP_Database class (now extends the PDO class)
    Rewritten: iMSCP_Database_ResultSet (now extends the PDOStatement class -- Renamed to iMSCP\Database\ResultSet)
    Rewritten: iMSCP_pTemplate class (renamed to iMSCP\TemplateEngine; aliased to iMSCP_pTemplate for bacwkard compatibility)

INSTALLER
    Added: `copy_as' attribute -- Allows to copy a file with specific name (copy_config xml node from install.xml files)
    Added: `create_if` attribute -- Allows to conditionally create a folder (folder xml node from install.xml files)
    Added: Missing patches for pam-mysql -- Devuan 1.0/Jessie
    Added: `pre_remove' attribute -- Allows to remove previous directory (folder xml node from install.xml files)
    Enhancement: Make it possible to provide per distribution (codename) configuration file
    Enhancement: Make it possible to replace IP address of all client with new primary IP (Servers::server::local::installer)
    Enhancement: Provide good default values for installer whenever possible
    Fixed: `build' mode is broken for fresh installs -- Packages must be pre-installed regardless of install mode
    Fixed: `CLIENT_DOMAIN_ALT_URLS' configuration parameter reseted to 0 (disabled) while running installer
    Fixed: `CLIENT_DOMAIN_ALT_URLS' parameter is not set on fresh installations
    Fixed: DIRMNGR(8) daemon not being terminated when expected (APT key management -- Debian adapter)
    Fixed: Don't assume RSYSLOGD(8) as system log daemon -- One drop-in replacement could be installed instead
    Fixed: Filtering of packages that must be uninstalled is made too early (autoinstaller::Adapter::DebianAdapter)
    Fixed: If a password is getting incorrect due to a password policy change, user must be warned
    Fixed: Setup dialog for the alternative URLs feature is not shown on fresh install
    Merged: Distribution layout.xml file with distribution master install.xml file
    Removed: `allow_switch` attribute from packages files (check is now done by the distribution adapter)
    Removed: `imscp_allow_writeable_root.patch` patch for vsftpd (no longer needed with latest version)
    Removed: `repository_conflict` attribute (packages files)
    Renamed: `kept` attribute to `keep_if_exist' (copy_config xml node from install.xml files)
    Renamed: `if' attribute to 'copy_if' (copy_config xml node from install.xml files)
    Review: Ask for confirmation in case the current SQL vendor is no longer available (safety measure)
    Review: Install all available PHP versions regardless of the selected PHP alternative for customers
    Review: Install external Perl modules through CPAN
    Review: Install the pre-required distribution packages through the i-MSCP installer wrapper script
    Review: Wrap the real i-MSCP installer for satisfying pre-requisites

LISTENERS
    Added: contrib/Listeners/APT/10_apt_sources_list.pl: Make it possible to provide it own SOURCES.LIST(5) file
    Fixed: All listener files should be versionned for easy update tracking
    Fixed: Listener::Php::ConfOptions::Override: PHP INI level not honoured
    Fixed: 10_named_slave_provisioning.pl: Global symbol "$rs" requires explicit package name
    Rewritten: 20_named_dualstack.pl listener file (require i-MSCP >= 1.6.0)
    Updated: 10_dovecot_compress.pl: Make use of /etc/dovecot/imscp.d directory to store configuration
    Updated: 20_dovecot_connections.pl: Make use of /etc/dovecot/imscp.d directory to store configuration
    Updated: 30_dovecot_namespace.pl: Make use of /etc/dovecot/imscp.d directory to store configuration
    Updated: 40_dovecot_pfs.pl: Make use of /etc/dovecot/imscp.d directory to store configuration
    Updated: 50_dovecot_plaintext.pl: Make use of /etc/dovecot/imscp.d directory to store configuration
    Updated: 60_dovecot_service_login.pl: Make use of /etc/dovecot/imscp.d directory to store configuration

PACKAGES
    Fixed: Distribution packages not installed in `build' mode (Package::AntiRootkits, Package::Webstats)
    Fixed: Limit number of Nginx worker processes in auto mode (Package::FrontEnd::Installer)
    Fixed: Logs must be preserved when upgrading/reconfiguring i-MSCP (Package::Webmail::Roundcube::Installer)
    Removed: Package::FileManager::Net2ftp::Net2ftp package -- The software is no longer maintained which make it unsafe
    Review: Cleanup production configuration files (Package::FrontEnd::Installer)
    Review: Disable both phpsessionclean timer and phpsessionclean service as we don't rely on them (Servers::php)
    Review: Set executable bit on *.sh scripts (Package::Webmail::Roundcube::Installer)
    Updated: Installer for use of Roundcube version 1.3.1 (Package::Webmail::Roundcube::Installer)

PLUGINS
    Added: Own event manager for plugin manager
    Enhancement: Make plugins able to trigger flush of cache (OPcache, userland cache (full or by ID)
    Fixed: Covers case of plugins that are uninstallable but not installable
    Fixed: Undefined offset -- Couldn't infer `Standard` plugin type
    Review: Avoid useless SQL query for plugin `run` action if there are no error (backend)
    Updated: Plugin API to version 1.5.1

PRESEEDING
    Enhancement: Make use of default alternatives when there is no value set for them

SCRIPTS
    Fixed: Avoid localization of `$@' variable (all scripts)
    Fixed: imscp-backup-all: Unexpected warning
    Fixed: Missing `--skip-distro-packages' (imscp-reconfigure)
    Fixed: maillogconvert.pl script is broken leading to un-processing of SMTP logs

SERVERS
    Fixed: Applications such as WHMCS behave unexpectedly with strict SQL mode -- Set SQL mode as with MySQL 5.5 (no SQL mode)
    Fixed: Avoid truncating ProFTPD and VsFTPD traffic log files -- Make use of LOGROTATE(8) instead
    Fixed: Bad `X_FORWARDED_PORT` header value for SSL redirect (proxy) vhosts (Apache2)
    Fixed: Bad `X_FORWARDED_PROTO` header value for SSL redirect (proxy) vhosts (Apache2)
    Fixed: Don't enforce SSL strict SNI (Apache2)
    Fixed: Make use of the INADDR_ANY address, regadless of domain IP address when primary server IP is set with `None` option (Httpd)
    Fixed: Set timeout to 5 seconds for LWP::Simple; Default value is far too hight (Servers::server::local::installer)
    Review: The FcgiBusyTimeout, FcgidMinProcessesPerClass and FcgidMaxProcessesPerClass Apache2 FCGID module parameters are now set on per vhost basis (Servers::php)
    Review: Make use of ipify.org as default service for WAN IP retrieval (Servers::server::local::installer)
    Rewritten: Servers::ftpd::courier::getTraffic() routine: Avoid IO operations (AMAP); Reduce memory consumption
    Rewritten: Servers::ftpd::dovecot::getTraffic() routine: Avoid IO operations (AMAP); Reduce memory consumption
    Rewritten: Servers::ftpd::postfix::getTraffic() routine: Avoid IO operations (AMAP), Reduce memory consumption
    Rewritten: Servers::ftpd::proftpd::getTraffic() routine: Avoid IO operations (AMAP); Reduce memory consumption
    Rewritten: Servers::ftpd::vsftpd::getTraffic() routine: Avoid IO operations (AMAP); Reduce memory consumption

VAGRANT
    Enhancement: Make users able to choice between many distributions
    Fixed: Can't locate Data/Validate/IP.pm in @INC (i-MSCP provision scripts)
    Fixed: Unable to locate package language-pack-en (i-MSCP provision scripts)
    Fixed: Make sure that Vagrant box is up-to-date before i-MSCP provisioning
    Fixed: Reboot the Vagrant box before provisioning it with i-MSCP (needed in case of kernel update)
    Fixed: Setup i-MSCP with public IP address (i-MSCP provision scripts)
    Merged: i-MSCP Vagrant provision scripts
    Updated: Vagrant box to vanilla Debian 9.1/Stretch from Vagrant Cloud (default Vagrant box)
    Review: Copy i-MSCP archive directory content under /user/local/src/imscp Vagrant box directory
    Review: Disable automatic box update checking in VagrantFile

VENDOR
    Added: Perl Array::Utils library
    Added: Perl library for exporting variables to PHP's expression (PHP::Var)
    Enhancement: Download and install all frontEnd dependencies through composer

YOUTRACK
    IP-1742 i-MSCP upgrade error - Unknown 'mail_user' database table in database update r254
    IP-1744 Couldn't go to support section -- 302 redirect to index.php -- reseller UI
    IP-1745 Rsyslog log rotation failure -- Initctl command (Upstart) doesn't know the 'rotate' action -- Ubuntu 14.04/Trusty Thar
    IP-1746 Error when generating SSL certificate - Could not write in openssl temp file
    IP-1749 User profile fields validation too strict
    IP-1750 Admin password cannot be changed
    IP-1751 CLIENT_DOMAIN_ALT_URLS reseted
    IP-1753 Preseed SECONDARY_DNS does not accept spaces (as indicated in the text)
    IP-1756 Reseller overview page is loading too slow due to a slow SQL query
    IP-1761 Wrong customer password after change through admin and reseller interfaces
    IP-1762 mod_proxy_fcgi - timeout too long

------------------------------------------------------------------------------------------------------------------------
Older release series
------------------------------------------------------------------------------------------------------------------------

See ./docs/Changelog-x.x.x files
